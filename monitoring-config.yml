# MedSync Hospital Claim System - Monitoring Configuration

# Prometheus Configuration
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alert_rules.yml"

scrape_configs:
  # Eureka Server
  - job_name: 'eureka-server'
    static_configs:
      - targets: ['localhost:8761']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 30s

  # API Gateway
  - job_name: 'api-gateway'
    static_configs:
      - targets: ['localhost:8080']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 30s

  # Staff Service
  - job_name: 'staff-service'
    static_configs:
      - targets: ['localhost:8081']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 30s

  # Patient Service
  - job_name: 'patient-service'
    static_configs:
      - targets: ['localhost:8082']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 30s

  # Hospital Service
  - job_name: 'hospital-service'
    static_configs:
      - targets: ['localhost:8083']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 30s

  # Insurance Company Service
  - job_name: 'insurance-company-service'
    static_configs:
      - targets: ['localhost:8084']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 30s

  # Claim Service
  - job_name: 'claim-service'
    static_configs:
      - targets: ['localhost:8085']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 30s

# Alert Rules
groups:
  - name: medsync_alerts
    rules:
      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Service {{ $labels.instance }} is down"
          description: "Service {{ $labels.instance }} has been down for more than 1 minute"

      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value }} errors per second"

      - alert: HighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 2
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High response time detected"
          description: "95th percentile response time is {{ $value }} seconds"

# Grafana Dashboard Configuration
grafana:
  dashboards:
    - name: "MedSync Hospital System"
      panels:
        - title: "Service Health"
          type: "stat"
          targets:
            - expr: "up"
        - title: "Request Rate"
          type: "graph"
          targets:
            - expr: "rate(http_requests_total[5m])"
        - title: "Error Rate"
          type: "graph"
          targets:
            - expr: "rate(http_requests_total{status=~\"5..\"}[5m])"
        - title: "Response Time"
          type: "graph"
          targets:
            - expr: "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))" 